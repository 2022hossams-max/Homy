<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قائمة المفضلة</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .favorites-grid { display: flex; flex-wrap: wrap; gap: 20px; justify-content: flex-start; margin-top: 20px;}
        .favorite-card { background-color: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; width: 250px; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }
        .favorite-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; }
        .remove-btn { background-color: #dc3545; margin-top: 10px; }
        .add-to-cart-btn { margin-left: 10px; }
    </style>
</head>
<body>
    <header>
        <h1>قائمة المفضلة</h1>
        <div>
            <a href="{{ url_for('home') }}" class="back-link">العودة للمتجر</a>
        </div>
    </header>
    
    <main>
        {% if products %}
            <div class="favorites-grid">
                {% for product in products %}
                    <div class="favorite-card" data-id="{{ product.id }}">
                        <a href="{{ url_for('product_detail', product_id=product.id) }}">
                            <img src="{{ product.image_url }}" alt="{{ product.name }}" onerror="this.src='/static/placeholder.png'">
                        </a>
                        <h3>{{ product.name }}</h3>
                        <p><strong>السعر: ${{ product.price | round(2) }}</strong></p>
                        
                        <button class="add-to-cart-btn" onclick="addToCart({{ product.id }})">أضف للسلة</button>
                        <button class="remove-btn" onclick="removeFromFavorites({{ product.id }})">إزالة</button>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="text-align: center; margin-top: 50px; font-size: 1.2em;">قائمة المفضلة فارغة حالياً. ابدأ بإضافة بعض المنتجات!</p>
        {% endif %}
    </main>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        // دالة لإزالة المنتج من المفضلة (تستخدم toggleFavorite من app.js)
        function removeFromFavorites(productId) {
            toggleFavorite(productId).then(() => {
                // إعادة تحميل الصفحة لرؤية التغييرات
                window.location.reload(); 
            });
        }
        
        // دالة إضافة للسلة (من app.js)
        function addToCart(productId) {
             fetch(`/cart/add/${productId}`)
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                })
                .catch(error => console.error('Error adding to cart:', error));
        }
    </script>
</body>
</html>
